WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WGLWidget",(function(t,e){e.wtObj=this;const n=this,i=t.WT,s=i.glMatrix.vec3,o=i.glMatrix.mat4;this.ctx=null;this.initializeGL=function(){};this.paintGL=function(){};this.resizeGL=function(){};this.updates=new Array;this.initialized=!1;this.preloadingTextures=0;this.preloadingBuffers=0;this.jsValues={};this.discoverContext=function(t,n){if(e.getContext){try{this.ctx=e.getContext("webgl",{antialias:n})}catch(t){}if(null===this.ctx)try{this.ctx=e.getContext("experimental-webgl",{antialias:n})}catch(t){}if(null===this.ctx){const n=e.firstChild;e.parentNode.insertBefore(n,e);e.style.display="none";t()}}return this.ctx};if(e.addEventListener){e.addEventListener("webglcontextlost",(function(t){t.preventDefault();n.initialized=!1}),!1);e.addEventListener("webglcontextrestored",(function(n){t.emit(e,"contextRestored")}),!1)}let u=null;this.setMouseHandler=function(t){u=t;u.setTarget&&u.setTarget(this)};this.LookAtMouseHandler=function(t,u,a,l,c){const h=t,r=u,f=a,d=l,g=c;let p=null,x=null,m=null,y=null;const M=this;this.mouseDown=function(t,n){i.capture(null);i.capture(e);y=i.pageCoordinates(n)};this.mouseUp=function(t,e){null!==y&&(y=null)};this.mouseDrag=function(t,e){if(null===y)return;const n=i.pageCoordinates(e);1===i.buttons&&C(n)};this.mouseWheel=function(t,e){i.cancelEvent(e);v(i.wheelDelta(e))};function v(t){const e=Math.pow(1.2,t);o.translate(h,r);o.scale(h,[e,e,e]);s.negate(r);o.translate(h,r);s.negate(r);n.paintGL()}function C(t){const e=h[5]/s.length([h[1],h[5],h[9]]),i=h[6]/s.length([h[2],h[6],h[10]]),u=Math.atan2(i,e),a=t.x-y.x,l=t.y-y.y,c=s.create();c[0]=h[0];c[1]=h[4];c[2]=h[8];const p=o.create();o.identity(p);o.translate(p,r);let x=l*d;if(Math.abs(u+x)>=Math.PI/2){x=(u>0?1:-1)*Math.PI/2-u}o.rotate(p,x,c);o.rotate(p,a*g,f);s.negate(r);o.translate(p,r);s.negate(r);o.multiply(h,p,h);n.paintGL();y=t}this.touchStart=function(t,n){x=1===n.touches.length;m=2===n.touches.length;if(x){i.capture(null);i.capture(e);y=i.pageCoordinates(n.touches[0])}else{if(!m)return;{const t=i.pageCoordinates(n.touches[0]),e=i.pageCoordinates(n.touches[1]);p=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}}n.preventDefault()};this.touchEnd=function(t,e){const n=0===e.touches.length;x=1===e.touches.length;m=2===e.touches.length;n&&M.mouseUp(null,null);(x||m)&&M.touchStart(t,e)};this.touchMoved=function(t,e){if(x||m){e.preventDefault();if(x){if(null===y)return;C(i.pageCoordinates(e))}if(m){const t=i.pageCoordinates(e.touches[0]),n=i.pageCoordinates(e.touches[1]),s=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y));let o=s/p;if(Math.abs(o-1)<.05)return;o=o>1?1:-1;p=s;v(o)}}}};this.WalkMouseHandler=function(t,u,a){const l=t,c=u,h=a;let r=null;this.mouseDown=function(t,n){i.capture(null);i.capture(e);r=i.pageCoordinates(n)};this.mouseUp=function(t,e){null!==r&&(r=null)};this.mouseDrag=function(t,e){if(null===r)return;f(i.pageCoordinates(e))};function f(t){const e=t.x-r.x,u=t.y-r.y,a=o.create();o.identity(a);o.rotateY(a,e*h);const f=s.create();f[0]=0;f[1]=0;f[2]=-c*u;o.translate(a,f);o.multiply(a,l,l);n.paintGL();r=i.pageCoordinates(event)}};this.mouseDrag=function(t,e){(this.initialized||!this.ctx)&&u&&u.mouseDrag&&u.mouseDrag(t,e)};this.mouseMove=function(t,e){(this.initialized||!this.ctx)&&u&&u.mouseMove&&u.mouseMove(t,e)};this.mouseDown=function(t,e){(this.initialized||!this.ctx)&&u&&u.mouseDown&&u.mouseDown(t,e)};this.mouseUp=function(t,e){(this.initialized||!this.ctx)&&u&&u.mouseUp&&u.mouseUp(t,e)};this.mouseWheel=function(t,e){(this.initialized||!this.ctx)&&u&&u.mouseWheel&&u.mouseWheel(t,e)};this.touchStart=function(t,e){(this.initialized||!this.ctx)&&u&&u.touchStart&&u.touchStart(t,e)};this.touchEnd=function(t,e){(this.initialized||!this.ctx)&&u&&u.touchEnd&&u.touchEnd(t,e)};this.touchMoved=function(t,e){(this.initialized||!this.ctx)&&u&&u.touchMoved&&u.touchMoved(t,e)};this.handlePreload=function(){if(0===this.preloadingTextures&&0===this.preloadingBuffers)if(this.initialized){for(const t of this.updates)t();this.updates=new Array;this.resizeGL();this.paintGL()}else{this.initializeGL();this.resizeGL();this.paintGL()}};e.wtEncodeValue=function(){const t=e.wtObj;let n="";for(const[e,i]of Object.entries(t.jsValues)){n+=e+":";for(let t=0;t<i.length;t++){n+=i[t];t!==i.length-1?n+=",":n+=";"}}return n};let a=null;const l=new Image;l.busy=!1;l.onload=function(){e.src=l.src;null!==a?l.src=a:l.busy=!1;a=null};l.onerror=l.onload;this.loadImage=function(t){if(l.busy)a=t;else{l.src=t;l.busy=!0}}}));