WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",(function(e,t,n,i,l,s,o,r,c){t.wtObj=this;const u=this,f=e.WT;let a=null,d=null,g=!1,h=null,p=null,y=s,C=null,v=null,k=!1;this.defaultValue=o;function T(){return"object"==typeof f.theme&&"bootstrap"===f.theme.type&&5===f.theme.version}function m(e){return e.classList.contains("Wt-suggest-onedit")||e.classList.contains("Wt-suggest-dropdown")}function L(){return"none"!==t.style.display}function E(i){const l=i.firstChild.firstChild,s=f.getElement(d),o=l.innerHTML,r=l.getAttribute("sug");s.focus();n(s,o,r);e.emit(t,"select",i.id,s.id);b();d=null}let w=null;this.showPopup=function(e){t.style.display="block";u.bringToFront();a=null;v=null;w=e.onkeydown;e.onkeydown=function(e){const t=e||window.event;u.editKeyDown(this,t)}};this.bringToFront=function(){const e=f.maxZIndex();if(e>t.style.zIndex){const n=e+1;t.style.zIndex=n}};function b(){t.style.display="none";if(null!==d&&null!==w){f.getElement(d).onkeydown=w;w=null}}function S(e){if(!T())return 16;try{const t=getComputedStyle(e),n=parseInt(t.backgroundSize.match(/^([0-9]+)px ([0-9]+)px$/)[1],10);return n+parseInt(t.backgroundPositionX.match(/^calc[(]100% - ([0-9]+)px[)]$/)[1],10)}catch(e){return 28}}this.editMouseMove=function(e,t){if(!m(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-S(e)){e.classList&&e.classList.add("Wt-suggest-dropdown-hover");e.style.cursor="default"}else{e.classList&&e.classList.remove("Wt-suggest-dropdown-hover");e.style.cursor=""}};this.showAt=function(e,t){b();d=e.id;k=!0;void 0===t&&(t="");u.refilter(t)};this.editClick=function(e,t){if(!m(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-S(e))if(d===e.id&&L()){b();d=null}else u.showAt(e,"")};function x(e,t){for(e=t?e.nextSibling:e.previousSibling;e;e=t?e.nextSibling:e.previousSibling)if(f.hasTag(e,"LI")&&"none"!==e.style.display)return e;return null}this.editKeyDown=function(e,n){if(!m(e))return!0;if(d!==e.id)if(e.classList.contains("Wt-suggest-onedit")){d=e.id;k=!1}else{if(!e.classList.contains("Wt-suggest-dropdown")||40!==n.keyCode){d=null;return!0}d=e.id;k=!0}if(L()){const i=a?f.getElement(a):null;if(13===n.keyCode||9===n.keyCode){if(i){E(i);f.cancelEvent(n);setTimeout((function(){e.focus()}),0)}else b();return!1}if(40===n.keyCode||38===n.keyCode||34===n.keyCode||33===n.keyCode){if("KEYDOWN"===n.type.toUpperCase()){g=!0;f.cancelEvent(n,f.CancelDefaultAction)}if("KEYPRESS"===n.type.toUpperCase()&&!0===g){f.cancelEvent(n);return!1}let e=i;const l=40===n.keyCode||34===n.keyCode;if(e){const s=34===n.keyCode||33===n.keyCode?t.clientHeight/i.offsetHeight:1;for(let t=0;e&&t<s;++t){const t=x(e,l);if(!t&&c)break;e=t}}else{e=function(e){const n=t.childNodes;for(let t=e?n[0]:n[n.length-1];t;t=e?t.nextSibling:t.previousSibling)if(f.hasTag(t,"LI")&&"none"!==t.style.display)return t;return null}(l);W(e)}if(i){i.classList.remove("active");T()&&i.firstChild.classList.remove("active");a=null}if(e&&f.hasTag(e,"LI")){e.classList.add("active");T()&&e.firstChild.classList.add("active");W(e);a=e.id}return!1}}return 13!==n.keyCode&&9!==n.keyCode};this.filtered=function(e,t){h=e;y=t;u.refilter(v)};function W(e){const t=e.parentNode;e.offsetTop+e.offsetHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)}this.refilter=function(n){if(!d)return;let o=a?f.getElement(a):null;const g=f.getElement(d),C=i(g),m=t.childNodes,E=r&&null!==n?n:C(null);v=r?n:g.value;if(l>0||s){if(E.length<l&&!k){b();return}{const n=y?E:E.substring(0,Math.max(null!==h?h.length:0,l));if(n!==h&&n!==p){p=n;e.emit(t,"filter",n)}}}let w=null,S=null;const x=k&&0===E.length;for(let e=0,t=m.length;e<t;++e){const t=m[e];if(f.hasTag(t,"LI")){const n=t.firstChild;null!==t.orig&&void 0!==t.orig||(t.orig=n.firstChild.innerHTML);const i=C(t.orig),l=x||i.match;i.suggestion!==n.firstChild.innerHTML&&(n.firstChild.innerHTML=i.suggestion);if(l){""!==t.style.display&&(t.style.display="");null===w&&(w=t);e===this.defaultValue&&(S=t)}else"none"!==t.style.display&&(t.style.display="none");t.classList.remove("active");T()&&t.firstChild.classList.remove("active")}}if(null===w)b();else{if(!L()){!function(e){t.style.display="block";f.positionAtWidget(t.id,e.id,f.Vertical)}(g);u.showPopup(g);o=null}if((c||S)&&(!o||"none"===o.style.display)){o=S||w;o.parentNode.scrollTop=0;a=o.id}if(o){o.classList.add("active");T()&&o.firstChild.classList.add("active");W(o)}}};this.editKeyUp=function(e,t){if(null!==d&&m(e)&&(L()||13!==t.keyCode&&9!==t.keyCode))if(27===t.keyCode||37===t.keyCode||39===t.keyCode)b();else if(40===t.keyCode||38===t.keyCode||34===t.keyCode||33===t.keyCode);else if(e.value!==v){d=e.id;u.refilter(e.value)}else{const e=a?f.getElement(a):null;e&&W(e)}};t.onclick=function(e){const t=e||window.event;let n=f.target(t);if(!f.hasTag(n,"UL")){for(;n&&!f.hasTag(n,"LI");)n=n.parentNode;n&&E(n)}};t.onscroll=function(){if(C){clearTimeout(C);const e=f.getElement(d);e&&e.focus()}};this.delayHide=function(e,n){C=setTimeout((function(){C=null;!t||null!==e&&d!==e.id||b()}),300)}}));WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",(function(e,t,n,i,l,s,o){function r(e){const t=e.value,l=e.selectionStart?e.selectionStart:t.length;let s=n?t.lastIndexOf(n,l-1)+1:0;for(;s<l&&-1!==i.indexOf(t.charAt(s));)++s;return{start:s,end:l}}this.match=function(n){const i=r(n),o=n.value.substring(i.start,i.end);let c;if(0===s.length)if(0!==l.length){c="(^|(?:[";for(let e=0;e<l.length;++e){let t=l.charCodeAt(e).toString(16);for(;t.length<4;)t="0"+t;c+="\\u"+t}c+="]))"}else c="(^)";else c="("+s+")";c+="("+o.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";c=new RegExp(c,"gi");return function(n){if(!n)return o;let i=!1;if(o.length){const l=n.replace(c,"$1"+e+"$2"+t);if(l!==n){i=!0;n=l}}return{match:i,suggestion:n}}};this.replace=function(e,t,n){const i=r(e);let l=e.value.substring(0,i.start)+n+o;i.end<e.value.length&&(l+=e.value.substring(i.end,e.value.length));e.value=l;if(e.selectionStart){e.selectionStart=i.start+n.length+o.length;e.selectionEnd=e.selectionStart}}}));